#!/bin/bash

echo "Using $namescheme as the base name for the cluster"

#Install clic modules
sudo su - -c "pip3 install $CLIC_ROOT/src --upgrade"

#Run some of them
source ~/.bashrc
if ! $cloud; then
	sudo clic-synchosts
fi
sudo clic-copyid --generate --append -u `whoami` $user `whoami`

#Create a service to start the clic daemon
echo -e "\n/etc/systemd/system/clic.service:"
path="`which clic`"
if $cloud; then
	cat $CLIC_ROOT/files/clic.service | sed "s&PATH&$path&g" | sed "s/CLOUD/--cloud/g" | sed "s/USER/$user/g" | sed "s/NAMESCHEME/$namescheme/g" | sudo tee /etc/systemd/system/clic.service
else
	cat $CLIC_ROOT/files/clic.service | sed "s&PATH&$path&g" | sed "s/CLOUD //g" | sed "s/USER/$user/g" | sed "s/NAMESCHEME/$namescheme/g" | sudo tee /etc/systemd/system/clic.service
fi
sudo systemctl enable clic.service
sudo systemctl restart clic.service
